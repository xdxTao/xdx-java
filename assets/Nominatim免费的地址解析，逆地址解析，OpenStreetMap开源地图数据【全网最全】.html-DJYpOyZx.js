import{_ as e}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as h,f as s,e as i,a,w as l,d as n,r as p,o as k}from"./app-CPTE7G04.js";const d="/assets/30_15-D7cWYQXx.png",r="/assets/30_16-DOXoDUsa.png",g={},o=n('<br><p><a href="https://www.bilibili.com/video/BV1sf421B71M" target="_blank" rel="noopener noreferrer">视频学习地址</a></p><br><blockquote><p>国内的一些地址解析供应商的API都开始付费了，就想找个免费的地址解析和逆地址解析的应用，最终选择了Nominatim + OpenStreetMap</p></blockquote><br><p>这篇文章将会从调研、选型、测试、应用全方面的解析，如果你也在找地址解析和逆地址解析的开源方案它一定会给你带来帮助</p><blockquote><p>地址解析：通过一个地名（深圳），获取当前地方的经纬度、省市区级别 逆地址解析：通过经纬度，获取当前位置的名称、省市区级别</p></blockquote><br><h2 id="一、选型" tabindex="-1"><a class="header-anchor" href="#一、选型"><span>一、选型</span></a></h2><br><h3 id="_1-1、数据源" tabindex="-1"><a class="header-anchor" href="#_1-1、数据源"><span>1-1、数据源</span></a></h3><br><p>对于地图解析这个应用来说，最重要不是软件部分，而是数据，只有数据全面了才有可能得出相对准确的结果。目前开源免费的全面的数据大概率只有 OpenStreetMap了，它是由各个国家的志愿者一起维护的数据</p>',13),y=n(`<br><p><strong>OpenStreeMap 相关文档链接 (后面会详解)</strong></p><table><thead><tr><th style="text-align:left;">描述</th><th style="text-align:left;">地址</th></tr></thead><tbody><tr><td style="text-align:left;">官网</td><td style="text-align:left;">https://www.openstreetmap.org</td></tr><tr><td style="text-align:left;">没有找到合适的中国数据，而且中国数据和台湾都是分开的，这必然不行，直接用亚洲的数据</td><td style="text-align:left;">https://download.openstreetmap.fr/extracts/</td></tr><tr><td style="text-align:left;">每一个地址都会有标签，标签很多想知道某个标签的含义，可去标签系统搜索，下面会讲解</td><td style="text-align:left;">https://taginfo.openstreetmap.org</td></tr></tbody></table><br><h3 id="_1-2、地理编码引擎" tabindex="-1"><a class="header-anchor" href="#_1-2、地理编码引擎"><span>1-2、地理编码引擎</span></a></h3><br><p><strong>调研时间：24年5月</strong></p><table><thead><tr><th style="text-align:left;">开源方案</th><th style="text-align:left;">Nominatim</th><th style="text-align:left;">Pelias</th><th style="text-align:left;">Photon</th></tr></thead><tbody><tr><td style="text-align:left;">支持数据源</td><td style="text-align:left;">OpenStreetMap</td><td style="text-align:left;">OpenStreetMap、OpenAddresses、Geonames等</td><td style="text-align:left;">OpenStreetMap</td></tr><tr><td style="text-align:left;">核心功能</td><td style="text-align:left;">地理编码和逆地理编码</td><td style="text-align:left;">地理编码和逆地理编码，支持全文搜索</td><td style="text-align:left;">高效地进行地理编码和逆地理编码</td></tr><tr><td style="text-align:left;">开发语言</td><td style="text-align:left;">Python、PHP</td><td style="text-align:left;">Twig</td><td style="text-align:left;">Java</td></tr><tr><td style="text-align:left;">GitHub关注数</td><td style="text-align:left;">2.9K</td><td style="text-align:left;">3.1K</td><td style="text-align:left;">1.8K</td></tr><tr><td style="text-align:left;">GitHub最新版本时间</td><td style="text-align:left;">2024-03-07</td><td style="text-align:left;">无</td><td style="text-align:left;">2024-03-06</td></tr><tr><td style="text-align:left;">GitHub待解决问题数</td><td style="text-align:left;">92</td><td style="text-align:left;">242</td><td style="text-align:left;">57</td></tr><tr><td style="text-align:left;">GitHub活跃度</td><td style="text-align:left;">高（去年发布10个版本）</td><td style="text-align:left;">低（无正式版本）</td><td style="text-align:left;">中（去年发布2个版本）</td></tr><tr><td style="text-align:left;">GitHub代码贡献者数</td><td style="text-align:left;">90</td><td style="text-align:left;">28</td><td style="text-align:left;">49</td></tr><tr><td style="text-align:left;">系统对接</td><td style="text-align:left;">REST API</td><td style="text-align:left;">REST API</td><td style="text-align:left;">REST API</td></tr></tbody></table><br><ol><li>Nominatim能满足功能需求，需要额外处理直辖市和港澳台问题</li><li>Photon 不支持中文国际化，无法满足</li></ol><br><p><strong>Nominatim 是一个开源的地理编码引擎，专门用于从 OSM 数据中提取地理信息。它提供了两种主要功能：</strong></p><ol><li>地理编码：将地址转换为经纬度坐标</li><li>逆地理编码：将经纬度坐标转换为地址</li></ol><br><blockquote><p>Nominatim 的API其实已经研究过了是满足的，下面详细讲解它的API</p></blockquote><br><h3 id="_2-1、初尝nominatim" tabindex="-1"><a class="header-anchor" href="#_2-1、初尝nominatim"><span>2-1、初尝Nominatim</span></a></h3><br><p>这个要VPN才可以访问</p><h4 id="_2-1-1、地址解析" tabindex="-1"><a class="header-anchor" href="#_2-1-1、地址解析"><span>2-1-1、地址解析</span></a></h4><br><p><strong>请求地址</strong></p><div class="language-curl line-numbers-mode" data-highlighter="shiki" data-ext="curl" data-title="curl" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>https://nominatim.openstreetmap.org/search?1=1&amp;q=深圳市&amp;format=geocodejson&amp;addressdetails=1&amp;accept-language=zh&amp;zoom=8&amp;limit=1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><br><p><strong>请求结果</strong></p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">    &quot;type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;FeatureCollection&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">    &quot;geocoding&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">        &quot;version&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;0.1.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">        &quot;attribution&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Data © OpenStreetMap contributors, ODbL 1.0. http://osm.org/copyright&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">        &quot;licence&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;ODbL&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">        &quot;query&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;深圳市&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">    &quot;features&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">            &quot;type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Feature&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">            &quot;properties&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">                &quot;geocoding&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">                    &quot;place_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">368109611</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">                    &quot;osm_type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;relation&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">                    &quot;osm_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3464353</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">                    &quot;osm_key&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;boundary&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">                    &quot;osm_value&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;administrative&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">                    &quot;type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;city&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">                    &quot;label&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;深圳市, 广东省, 中国&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">                    &quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;深圳市&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">                    &quot;state&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;广东省&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">                    &quot;country&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;中国&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">                    &quot;country_code&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;cn&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">                    &quot;admin&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">                        &quot;level5&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;深圳市&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">                        &quot;level4&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;广东省&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">            &quot;geometry&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">                &quot;type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Point&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">                &quot;coordinates&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: [</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">                    114.0545429</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">                    22.5445741</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><br><h4 id="_2-1-2、逆地址解析" tabindex="-1"><a class="header-anchor" href="#_2-1-2、逆地址解析"><span>2-1-2、逆地址解析</span></a></h4><br><p><strong>请求地址</strong></p><div class="language-curl line-numbers-mode" data-highlighter="shiki" data-ext="curl" data-title="curl" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>https://nominatim.openstreetmap.org/reverse?format=geocodejson&amp;lat=43.767755&amp;lon=87.51623&amp;addressdetails=1&amp;accept-language=zh&amp;zoom=8&amp;limit=1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><br><p><strong>请求结果</strong></p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    &quot;type&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;FeatureCollection&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    &quot;geocoding&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">        &quot;version&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;0.1.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">        &quot;attribution&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;Data © OpenStreetMap contributors, ODbL 1.0. http://osm.org/copyright&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">        &quot;licence&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;ODbL&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">        &quot;query&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    }</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    &quot;features&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">        {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">            &quot;type&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;Feature&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">            &quot;properties&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                &quot;geocoding&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                    &quot;place_id&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 190215046</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                    &quot;osm_type&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;relation&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                    &quot;osm_id&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 5663100</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                    &quot;osm_key&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;boundary&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                    &quot;osm_value&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;administrative&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                    &quot;type&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;district&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                    &quot;accuracy&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                    &quot;label&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;沙依巴克区, 乌鲁木齐市, 新疆维吾尔自治区, 830000, 中国&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                    &quot;name&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;沙依巴克区&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                    &quot;postcode&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;830000&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                    &quot;city&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;乌鲁木齐市&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                    &quot;state&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;新疆维吾尔自治区&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                    &quot;country&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;中国&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                    &quot;country_code&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;cn&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                    &quot;admin&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                        &quot;level6&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;沙依巴克区&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                        &quot;level5&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;乌鲁木齐市&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                        &quot;level4&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;新疆维吾尔自治区&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">                    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">                }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">            }</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">            &quot;geometry&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                &quot;type&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;Point&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                &quot;coordinates&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> [</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">                    87.46749</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">                    43.726972</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">                ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><br><h3 id="_2-2、osm数据解析" tabindex="-1"><a class="header-anchor" href="#_2-2、osm数据解析"><span>2-2、OSM数据解析</span></a></h3><br><p>对于地图服务真正难的是数据，核心也还是OSM的数据，后面会讲怎么导入数据，这里先解析数据。把OSM的数据导入到 PostgreSQL后，它有两张重要的表，个人感觉对于一般应用来说，理解这两张表就够够了 （下面是我的理解，供参考）</p><ul><li>place：place表维护的是每一条独立的数据（可以是一棵树、也可以是一条河、一个城市）</li><li>placex：因为地区是包含关系placex维护的是有关系的上下级数据</li></ul><p>表字段很多，下面讲重要的，如果对这两张表结构感兴趣的可以参看下面的： <mark>N-1</mark></p><br><h4 id="_2-2-1、place表" tabindex="-1"><a class="header-anchor" href="#_2-2-1、place表"><span>2-2-1、place表</span></a></h4><br><table><thead><tr><th style="text-align:left;">字段</th><th style="text-align:left;">描述</th></tr></thead><tbody><tr><td style="text-align:left;">osm_id</td><td style="text-align:left;">数据的唯一id</td></tr><tr><td style="text-align:left;">osm_type</td><td style="text-align:left;">数据类型：N、R、W （对表500w数据 distinct + 搜索） <br> <br> 1.节点（Node）：存储为一个经纬度坐标点。例如，一个节点可能表示一个具体的地理位置，如一座建筑物的角落或一棵树 <br> 2.路径（Way）：由一系列节点组成，每个节点都有其自己的经纬度坐标。路径可以表示线性特征（如道路）或闭合区域（如湖泊） <br> 3.关系（Relation）：由多个节点和路径组成，表示更复杂的地理特征和逻辑关系，如边界、多边形区域或路线</td></tr><tr><td style="text-align:left;">class</td><td style="text-align:left;">这两个字段是一起的 key=value，是对这条数据打的标签，目前有 9w+个key <br> <br> <strong>highway=secondary</strong> <br>1. highway标签是用于任何类型道路的主要标签 <br>2. highway=secondary 次要道路是连接重要城镇的道路<br><br>注：https://taginfo.openstreetmap.org 因为key=value 太多了，官方有专门维护描述</td></tr><tr><td style="text-align:left;">type</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">admin_level</td><td style="text-align:left;">当前数据的等级，数据库有 1-15级 （抽样查看了每一层的数据，并不是特别的标准）</td></tr><tr><td style="text-align:left;">name</td><td style="text-align:left;">当前数据的各种语言的描述，地址解析的时候我猜就是匹配这个字段 <br> <br> eg: <br>&quot;name&quot;=&gt;&quot;深圳市&quot;, &quot;name:af&quot;=&gt;&quot;Shenzhen&quot;, &quot;name:ar&quot;=&gt;&quot;شنجن (الصين)&quot;, &quot;name:az&quot;=&gt;&quot;Şençjen&quot;, &quot;name:ba&quot;=&gt;&quot;Шэньчжэнь&quot;, &quot;name:be&quot;=&gt;&quot;Шэньчжэнь&quot;,</td></tr><tr><td style="text-align:left;">geometry</td><td style="text-align:left;">当前数据的经纬度，数据存在多种可能性，比如点、线、多线、多边形、几何图形 等 <br><br> 注：数据并不全是存的明文，有些是加密的，可以通过在线工具解密https://www.zaixianjisuan.com/dilicesuan/wkt%20_%20wkb%20_%20geojson%20convert%20online.html</td></tr></tbody></table><br><p><strong>geometry 存储数据样例</strong></p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">POINT</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">117.1767305</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 39.1448629</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">LINESTRING</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">117.1847722</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 39.1481168</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 117.1845921</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 39.1481353</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">POLYGON</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">((</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">117.1829091</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 39.1494689</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 117.182913</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 39.1494281</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 117.1829335</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 39.1493904</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 117.1829685</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 39.1493598</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 117.1830143</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 39.1493394</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 117.183066</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 39.1493315</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 117.1831199</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 39.1493372</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 117.1831478</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 39.1493482</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 117.1831683</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 39.1493563</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 117.183206</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 39.1493867</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 117.1832286</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 39.1494251</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 117.1832337</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 39.149467</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 117.1832206</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 39.149508</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 117.183191</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 39.1495433</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 117.183148</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 39.1495691</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 117.1830964</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 39.1495825</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 117.183042</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 39.1495819</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 117.1829924</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 39.1495681</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 117.182951</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 39.1495428</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 117.1829222</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 39.1495085</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 117.1829091</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 39.1494689</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">))</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><br><h4 id="_2-2-2、placex表" tabindex="-1"><a class="header-anchor" href="#_2-2-2、placex表"><span>2-2-2、placex表</span></a></h4><br><p>placex 表的关键信息，它很多字段和place表一样</p><table><thead><tr><th style="text-align:left;">字段名</th><th style="text-align:left;">描述</th></tr></thead><tbody><tr><td style="text-align:left;">place_id</td><td style="text-align:left;">数据的唯一id</td></tr><tr><td style="text-align:left;">parent_place_id</td><td style="text-align:left;">上级id</td></tr><tr><td style="text-align:left;">importance</td><td style="text-align:left;">数据权重，匹配到多条数据，这个字段是排序规则之一</td></tr><tr><td style="text-align:left;">centroid</td><td style="text-align:left;">当前区域的中心点 （是个POINT类型的 经纬度，参看上面的 geometry）</td></tr><tr><td style="text-align:left;">postcode</td><td style="text-align:left;">邮编</td></tr><tr><td style="text-align:left;">country_code</td><td style="text-align:left;">国家编码 cn</td></tr><tr><td style="text-align:left;">osm_type</td><td style="text-align:left;">同 place表</td></tr><tr><td style="text-align:left;">osm_id</td><td style="text-align:left;">同 place表</td></tr><tr><td style="text-align:left;">class</td><td style="text-align:left;">同 place表</td></tr><tr><td style="text-align:left;">type</td><td style="text-align:left;">同 place表</td></tr><tr><td style="text-align:left;">admin_level</td><td style="text-align:left;">同 place表</td></tr><tr><td style="text-align:left;">name</td><td style="text-align:left;">同 place表</td></tr><tr><td style="text-align:left;">geometry</td><td style="text-align:left;">同 place表</td></tr></tbody></table><br><blockquote><p>这个表数据很重要，解析和逆解析都是对这个表进行搜索</p></blockquote><br><h3 id="_2-3、nominatim和osm数据关系映射" tabindex="-1"><a class="header-anchor" href="#_2-3、nominatim和osm数据关系映射"><span>2-3、Nominatim和OSM数据关系映射</span></a></h3><br><p><strong>Nominatim和OpenStreetMap 字段映射关系（从上面的返回值抽取稳定有用的字段）</strong></p><table><thead><tr><th style="text-align:left;">Nominatim 返回字段</th><th style="text-align:left;">OpenStreeMap 字段（对应表 placex）</th></tr></thead><tbody><tr><td style="text-align:left;">place_id</td><td style="text-align:left;">place_id</td></tr><tr><td style="text-align:left;">osm_id</td><td style="text-align:left;">osm_id</td></tr><tr><td style="text-align:left;">osm_type</td><td style="text-align:left;">osm_type</td></tr><tr><td style="text-align:left;">osm_key</td><td style="text-align:left;">class</td></tr><tr><td style="text-align:left;">osm_value</td><td style="text-align:left;">type</td></tr><tr><td style="text-align:left;">admin[]</td><td style="text-align:left;">在 placex 表有个parent_place_id，一直向上取到 parent_place_id = 0 <br><br> key = level + admin_level <br> value = name -&gt; &#39;name&#39;</td></tr><tr><td style="text-align:left;">postcode</td><td style="text-align:left;">postcode</td></tr><tr><td style="text-align:left;">label</td><td style="text-align:left;">admin + postcode</td></tr><tr><td style="text-align:left;">geometry</td><td style="text-align:left;">centroid</td></tr></tbody></table><br><h3 id="_2-4、举一反三" tabindex="-1"><a class="header-anchor" href="#_2-4、举一反三"><span>2-4、举一反三</span></a></h3><br><p>通过上面的分析得出2点</p><ol><li>Nominatim 就是一个地图搜索引擎，用的是OSM的数据</li><li>Nominatim 不管是解析还是逆解析返回的都是 placex 表的某条数据（place_id）</li></ol>`,64),c=n(`<br><p><strong>地址解析SQL</strong></p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">SELECT</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    place_id</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    ST_AsText</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(geometry) </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">AS</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> geometry</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> placex</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> name </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">-&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;name&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> ILIKE </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;%中国%&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">AND</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> importance </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">IS</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> NOT</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> NULL</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">ORDER</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> BY</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> importance </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">DESC</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">LIMIT </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><br><p><strong>逆地址解析SQL</strong></p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    place_id</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    ST_X</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(centroid) </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">AS</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> lon</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    ST_Y</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(centroid) </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">AS</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> lat</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    ST_Distance</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(geometry</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">::</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">geography</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> ST_SetSRID</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">ST_MakePoint</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">90.392926</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">30.014464</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 4326</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">::</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">geography) </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">AS</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> distance</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> placex</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    ST_Distance</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(geometry</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">::</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">geography</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> ST_SetSRID</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">ST_MakePoint</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">90.392926</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">30.014464</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 4326</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">::</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">geography) BETWEEN </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> AND </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1000</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">ORDER</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> BY</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    distance ASC</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    importance </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">DESC</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">LIMIT </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><br><p><strong>测试结果和Nominatim返回的结果相似度90%+，但性能没法比，SQL运行结果很慢</strong></p><br><h3 id="_2-5、nominatim-api解析" tabindex="-1"><a class="header-anchor" href="#_2-5、nominatim-api解析"><span>2-5、Nominatim API解析</span></a></h3><br><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">https</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">//nominatim.openstreetmap.org/search?1=1&amp;q=深圳市&amp;format=geocodejson&amp;addressdetails=1&amp;accept-language=zh&amp;zoom=8&amp;limit=1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">https</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">//nominatim.openstreetmap.org/reverse?format=geocodejson&amp;lat=43.767755&amp;lon=87.51623&amp;addressdetails=1&amp;accept-language=zh&amp;zoom=8&amp;limit=1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><br><p>上面这两个URL在绝大部分场景下，已经是最佳答案了，如果你还需要其它的请参考官方API文档</p><ul><li>https://nominatim.org/release-docs/develop/api/Search/</li><li>https://nominatim.org/release-docs/develop/api/Reverse/</li></ul><br><table><thead><tr><th style="text-align:left;">字段</th><th style="text-align:left;">描述</th></tr></thead><tbody><tr><td style="text-align:left;">q</td><td style="text-align:left;">文本查询 （不和省、市、区 这些字段一起使用）</td></tr><tr><td style="text-align:left;">format</td><td style="text-align:left;">返回的数据格式，相信我 geocodejson 是最好的格式，因为它最接近数据库的数据</td></tr><tr><td style="text-align:left;">addressdetails</td><td style="text-align:left;">是否返回地址详情</td></tr><tr><td style="text-align:left;">accept-language</td><td style="text-align:left;">zh 返回中文，不然可能会有少数民族文字</td></tr><tr><td style="text-align:left;">limit</td><td style="text-align:left;">限制返回条数（数据已经是按照权重排好序了，大部分场景只要一条数据，所以 limit=1）</td></tr><tr><td style="text-align:left;">zoom=8</td><td style="text-align:left;">返回的层级 4级基本是省份，5级基本是城市 （建议带上这个参数，不然极少数情况会出错，作者说的）</td></tr><tr><td style="text-align:left;">lat、lon</td><td style="text-align:left;">经纬度</td></tr></tbody></table><br><h2 id="三、安装" tabindex="-1"><a class="header-anchor" href="#三、安装"><span>三、安装</span></a></h2><br><p>https://download.openstreetmap.fr/extracts/asia.osm.pbf 下载亚洲的 PBF文件 （先看四）</p><p>然后去你的服务上用docker安装（差不多要300G磁盘），执行过程大概4天半左右</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">docker run </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">d </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">it </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">--</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">shm</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">size</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">12g </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">e </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">PBF_PATH</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">nominatim</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">osm_data</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">下载下来的数据</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">pbf</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">e IMPORT_STYLE</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">address </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">e NOMINATIM_FLATNODE_FILE</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">nominatim</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">flat_data</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">flatnode</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">file</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">p </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8090</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8080</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">p </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">5432</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">5432</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">v </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">nominatim</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">flat_data</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">nominatim</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">flat_data </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">v </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">nominatim</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">osm_data</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">nominatim</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">osm_data </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">--</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">name planet mediagis</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">nominatim</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">4.4</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><br><br></p><blockquote><p>官网dockert安装地址：https://github.com/mediagis/nominatim-docker/tree/master/4.4 <br> 非docker安装需要很多各种依赖较为麻烦</p></blockquote><br><h2 id="四、关于数据源-重要" tabindex="-1"><a class="header-anchor" href="#四、关于数据源-重要"><span>四、关于数据源 （重要）</span></a></h2><br><p><strong>尝试过的数据源</strong></p>`,29),u=s("thead",null,[s("tr",null,[s("th",{style:{"text-align":"left"}},"问题"),s("th",{style:{"text-align":"left"}},"数据范围"),s("th",{style:{"text-align":"left"}},"数据源")])],-1),B=s("tr",null,[s("td",{style:{"text-align":"left"}},"Nominatim不支持map和img格式"),s("td",{style:{"text-align":"left"}},"中国"),s("td",{style:{"text-align":"left"}},"https://download3.bbbike.org/osm/garmin/region/asia/china/")],-1),C=s("tr",null,[s("td",{style:{"text-align":"left"}},"Nominatim不支持map和img格式"),s("td",{style:{"text-align":"left"}},"中国"),s("td",{style:{"text-align":"left"}},"https://download3.bbbike.org/osm/mapsforge/region/asia/china/")],-1),m=s("tr",null,[s("td",{style:{"text-align":"left"}},"数据不全，部分数据有问题"),s("td",{style:{"text-align":"left"}},"中国"),s("td",{style:{"text-align":"left"}},"https://download.openstreetmap.fr/extracts/asia/china-latest.osm.pbf")],-1),E=s("tr",null,[s("td",{style:{"text-align":"left"}},"数据不全，部分数据有问题"),s("td",{style:{"text-align":"left"}},"中国"),s("td",{style:{"text-align":"left"}},"https://download.geofabrik.de/asia.html")],-1),A=s("tr",null,[s("td",{style:{"text-align":"left"}},"数据不全，部分数据有问题"),s("td",{style:{"text-align":"left"}},"中国"),s("td",{style:{"text-align":"left"}},"https://osmtoday.com/asia.html")],-1),b={style:{"text-align":"left"}},v={style:{"text-align":"left"}},D=s("td",{style:{"text-align":"left"}},"https://download.openstreetmap.fr/extracts/asia.osm.pbf",-1),F=n('<br><p><strong>数据源相关文章：</strong></p><p>https://wiki.openstreetmap.org/wiki/Zh-hans:Planet.osm https://www.chinaflier.com/thread-202695-1-1.html https://github.com/osm-search/Nominatim/discussions/3434</p><br><blockquote><p>尝试了很多的中国数据一直都不准，最后抱着试试的心理尝试了亚洲的数据，完美 <br><br></p><ul><li>服务器：4核32G</li><li>亚洲 pbf 15g</li><li>导入时间 4天半</li><li>消耗空间 277G</li></ul></blockquote><figure><img src="'+d+`" alt="在这里插入图片描述" tabindex="0" loading="lazy"><figcaption>在这里插入图片描述</figcaption></figure><br><h2 id="五、替代方案" tabindex="-1"><a class="header-anchor" href="#五、替代方案"><span>五、替代方案</span></a></h2><br><p>如果你只是需要简单的地址解析和逆地址解析，其实也不用如此大费周章，可以参看：</p><p>https://blog.csdn.net/Tomwildboar/article/details/139882311</p><br><h2 id="n、其它" tabindex="-1"><a class="header-anchor" href="#n、其它"><span>N、其它</span></a></h2><br><h3 id="n-1、place和placex" tabindex="-1"><a class="header-anchor" href="#n-1、place和placex"><span>N-1、place和placex</span></a></h3><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">public</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&quot;.</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;place&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  &quot;osm_type&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> char</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">COLLATE</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;pg_catalog&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;default&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  &quot;osm_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> int8 </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  &quot;class&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> text</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> COLLATE</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;pg_catalog&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;default&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  &quot;type&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> text</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> COLLATE</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;pg_catalog&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;default&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  &quot;admin_level&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> int2,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  &quot;name&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;public&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hstore&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  &quot;address&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;public&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hstore&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  &quot;extratags&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;public&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hstore&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  &quot;geometry&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> geometry</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">GEOMETRY</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">4326</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">NOT NULL</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">public</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&quot;.</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;placex&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  &quot;place_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> int8 </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  &quot;parent_place_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> int8,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  &quot;linked_place_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> int8,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  &quot;importance&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> float8,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  &quot;indexed_date&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> timestamp</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">6</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  &quot;geometry_sector&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> int4,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  &quot;rank_address&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> int2,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  &quot;rank_search&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> int2,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  &quot;partition&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> int2,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  &quot;indexed_status&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> int2,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  &quot;osm_type&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> char</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">COLLATE</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;pg_catalog&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;default&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  &quot;osm_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> int8 </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  &quot;class&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> text</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> COLLATE</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;pg_catalog&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;default&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  &quot;type&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> text</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> COLLATE</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;pg_catalog&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;default&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  &quot;admin_level&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> int2,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  &quot;name&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;public&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hstore&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  &quot;address&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;public&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hstore&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  &quot;extratags&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;public&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hstore&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  &quot;geometry&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> geometry</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">GEOMETRY</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">4326</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  &quot;wikipedia&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> text</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> COLLATE</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;pg_catalog&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;default&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  &quot;token_info&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> jsonb,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  &quot;country_code&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">COLLATE</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;pg_catalog&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;default&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  &quot;housenumber&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> text</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> COLLATE</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;pg_catalog&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;default&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  &quot;postcode&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> text</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> COLLATE</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;pg_catalog&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;default&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  &quot;centroid&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> geometry</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">GEOMETRY</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">4326</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><br><h3 id="n-2、相关资料" tabindex="-1"><a class="header-anchor" href="#n-2、相关资料"><span>N-2、相关资料</span></a></h3><br><table><thead><tr><th style="text-align:left;">描述</th><th style="text-align:left;">地址</th></tr></thead><tbody><tr><td style="text-align:left;">OSM 官网</td><td style="text-align:left;">https://www.openstreetmap.org</td></tr><tr><td style="text-align:left;">OSM官方对中国地图的描述</td><td style="text-align:left;">https://wiki.openstreetmap.org/wiki/Zh-hans:%E4%B8%AD%E5%8D%8E%E4%BA%BA%E6%B0%91%E5%85%B1%E5%92%8C%E5%9B%BD</td></tr><tr><td style="text-align:left;">数据标签查询</td><td style="text-align:left;">https://taginfo.openstreetmap.org</td></tr><tr><td style="text-align:left;">Nominatim 地址解析API</td><td style="text-align:left;">https://nominatim.org/release-docs/develop/api/Search/</td></tr><tr><td style="text-align:left;">Nominatim 逆地址解析API</td><td style="text-align:left;">https://nominatim.org/release-docs/develop/api/Reverse/</td></tr><tr><td style="text-align:left;">Nominatim docker安装地址</td><td style="text-align:left;">https://github.com/mediagis/nominatim-docker/tree/master/4.4</td></tr><tr><td style="text-align:left;">官网API查询数据没有 level5问题</td><td style="text-align:left;">https://github.com/osm-search/Nominatim/issues/3437</td></tr><tr><td style="text-align:left;">官方说明只能导入 pbf、osm 格式</td><td style="text-align:left;">https://github.com/osm-search/Nominatim/discussions/3436</td></tr><tr><td style="text-align:left;">pbf、bz2、shp.zip 数据格式含义</td><td style="text-align:left;">https://download.geofabrik.de/technical.html</td></tr><tr><td style="text-align:left;">数据源</td><td style="text-align:left;">https://download.geofabrik.de/asia.html（福建省数据不是很准）</td></tr><tr><td style="text-align:left;">数据源</td><td style="text-align:left;">https://download3.bbbike.org/osm/garmin/region/asia/china/ （Nominatim不支持map和img格式）</td></tr><tr><td style="text-align:left;">数据源</td><td style="text-align:left;">https://osmtoday.com/asia.html （数据不全，部分数据有问题））</td></tr><tr><td style="text-align:left;">数据源</td><td style="text-align:left;">https://download.openstreetmap.fr/extracts/asia/china-latest.osm.pbf（数据不全，部分数据有问题）</td></tr><tr><td style="text-align:left;">百度提供的在线经纬度获取</td><td style="text-align:left;">https://api.map.baidu.com/lbsapi/getpoint/index.html</td></tr><tr><td style="text-align:left;">经纬度在线解析</td><td style="text-align:left;">https://www.zaixianjisuan.com/dilicesuan/wkt%20_%20wkb%20_%20geojson%20convert%20online.html</td></tr><tr><td style="text-align:left;">其它阅读</td><td style="text-align:left;">https://wiki.openstreetmap.org/wiki/Zh-hans:Planet.osm <br>https://www.chinaflier.com/thread-202695-1-1.html <br>https://github.com/osm-search/Nominatim/discussions/3434</td></tr></tbody></table><br><figure><img src="`+r+'" alt="在这里插入图片描述" tabindex="0" loading="lazy"><figcaption>在这里插入图片描述</figcaption></figure><br><h3 id="n-3、测试覆盖" tabindex="-1"><a class="header-anchor" href="#n-3、测试覆盖"><span>N-3、测试覆盖</span></a></h3><br><p>我此次的需求只需要精确到 省、市，直接用GPT列举出全部的市级以上的数据，然后再自己每个省份描点经纬度100个，再让GPT生成随机每个省的经纬度 1000个。</p><p>让自建API和腾讯API进行对比，问题如下</p><br><h4 id="地址解析" tabindex="-1"><a class="header-anchor" href="#地址解析"><span>地址解析</span></a></h4><ol><li>香港、澳门，腾讯的是带了 【行政区】 后缀，且存在部分的繁体字</li><li>台湾 腾讯返回的都是简体字，自建地图大部分数据返回的是繁体字</li></ol><br><h3 id="逆地址解析" tabindex="-1"><a class="header-anchor" href="#逆地址解析"><span>逆地址解析</span></a></h3>',32),q=s("table",null,[s("thead",null,[s("tr",null,[s("th",{style:{"text-align":"left"}},"入参"),s("th",{style:{"text-align":"left"}},"自建"),s("th",{style:{"text-align":"left"}},"腾讯"),s("th",{style:{"text-align":"left"}},"百度")])]),s("tbody",null,[s("tr",null,[s("td",{style:{"text-align":"left"}},"110.39119,20.091971"),s("td",{style:{"text-align":"left"},longitude:"110.3715545,",latitude:"20.0748919,",nation:"'中国',",province:"'海南省',",city:"'海口市'"}),s("td",{style:{"text-align":"left"},nation:"'中国',",province:"'中国区域',",city:"'',",district:"'',",street:"''"}),s("td",{style:{"text-align":"left"}},"海南省海口市美兰区")]),s("tr",null,[s("td",{style:{"text-align":"left"}},"101.808916,36.653178"),s("td",{style:{"text-align":"left"},longitude:"101.8128242,",latitude:"36.649104,",nation:"'中国',",province:"'青海省',",city:"'西宁市'"}),s("td",{style:{"text-align":"left"},nation:"'中国',",province:"'青海省',",city:"'海东市',",district:"'互助土族自治县',",street:"''"}),s("td",{style:{"text-align":"left"}},"青海省西宁市城北区")]),s("tr",null,[s("td",{style:{"text-align":"left"}},"91.276412,29.525961"),s("td",{style:{"text-align":"left"},longitude:"91.4130822,",latitude:"29.2551346,",nation:"'中国',",province:"'西藏自治区',",city:"'山南市'"}),s("td",{style:{"text-align":"left"},nation:"'中国',",province:"'西藏自治区',",city:"'拉萨市',",district:"'城关区',",street:"''"}),s("td",{style:{"text-align":"left"}},"西藏自治区山南市扎囊县")]),s("tr",null,[s("td",{style:{"text-align":"left"}},"113.795412,34.887975"),s("td",{style:{"text-align":"left"},longitude:"113.7888121,",latitude:"34.921496,",nation:"'中国',",province:"'河南省',",city:"'新乡市'"}),s("td",{style:{"text-align":"left"},nation:"'中国',",province:"'河南省',",city:"'郑州市',",district:"'惠济区',",street:"''"}),s("td",{style:{"text-align":"left"}},"河南省郑州市惠济区")]),s("tr",null,[s("td",{style:{"text-align":"left"}},"112.12054,40.707765"),s("td",{style:{"text-align":"left"},longitude:"112.120318174164,",latitude:"40.71081296482041,",nation:"'中国',",province:"'内蒙古自治区',",city:"'乌兰察布市'"}),s("td",{style:{"text-align":"left"},nation:"'中国',",province:"'内蒙古自治区',",city:"'呼和浩特市',",district:"'赛罕区',",street:"''"}),s("td",{style:{"text-align":"left"}},"内蒙古自治区呼和浩特市赛罕区")]),s("tr",null,[s("td",{style:{"text-align":"left"}},"113.273535,27.875086"),s("td",{style:{"text-align":"left"},longitude:"113.7001702,",latitude:"28.2178951,",nation:"'中国',",province:"'湖南省',",city:"'长沙市'"}),s("td",{style:{"text-align":"left"},nation:"'中国',",province:"'湖南省',",city:"'株洲市',",district:"'荷塘区',",street:"''"}),s("td",{style:{"text-align":"left"}},"湖南省株洲市荷塘区X004(宋芷路)")]),s("tr",null,[s("td",{style:{"text-align":"left"}},"101.885386,36.529808"),s("td",{style:{"text-align":"left"},longitude:"101.9975,",latitude:"36.399977,",nation:"'中国',",province:"'青海省',",city:"'海东市'"}),s("td",{style:{"text-align":"left"},nation:"'中国',",province:"'青海省',",city:"'西宁市',",district:"'湟中区',",street:"''"}),s("td",{style:{"text-align":"left"}},"青海省西宁市湟中区")]),s("tr",null,[s("td",{style:{"text-align":"left"}},"121.827422,24.73118"),s("td",{style:{"text-align":"left"},longitude:"120.9820179,",latitude:"23.9739374,",nation:"'中国',",province:"'臺灣',",city:"'臺灣'"}),s("td",{style:{"text-align":"left"},nation:"'中国',",province:"'台湾省',",city:"'宜兰县',",district:"'壮围乡',",street:"''"}),s("td",{style:{"text-align":"left"}},"台湾省宜兰县")])])],-1),f=s("br",null,null,-1),x=s("p",null,[s("strong",null,"结论")],-1),_=s("p",null,"1.现在的亚洲的数据和官网几乎一样 2.和腾讯比，也只有很少边界的地方存在误差",-1);function N(O,S){const t=p("font");return k(),h("div",null,[o,s("p",null,[i("OpenStreetMap（后面简称OSM） 是一个众包的地图项目，旨在创建一个可自由编辑和使用的世界地图数据库。它由全球的志愿者贡献者更新和维护，提供了一个详细和准确的地理数据集合。OSM 数据包括道路、建筑物、自然特征、商业设施等（"),a(t,{color:"green"},{default:l(()=>[i("简单理解就是很多志愿者一起维护了一份地图数据 ")]),_:1}),i("）")]),y,a(t,{color:"#6DD162"},{default:l(()=>[i(" 通过对数据的分析和一些文档描述，大概知道了它搜索的逻辑地址解析就是去模糊匹配 name，逆地址解析就是拿入参的经纬度去找数据库距离最近权重最高的数据返回 ")]),_:1}),c,s("table",null,[u,s("tbody",null,[B,C,m,E,A,s("tr",null,[s("td",b,[a(t,{color:"green"},{default:l(()=>[i("完美 ")]),_:1})]),s("td",v,[a(t,{color:"green"},{default:l(()=>[i("亚洲")]),_:1})]),D])])]),F,q,f,x,_])}const w=e(g,[["render",N],["__file","Nominatim免费的地址解析，逆地址解析，OpenStreetMap开源地图数据【全网最全】.html.vue"]]),M=JSON.parse('{"path":"/30%E6%89%A9%E5%B1%95%E5%AD%A6%E4%B9%A0/Nominatim%E5%85%8D%E8%B4%B9%E7%9A%84%E5%9C%B0%E5%9D%80%E8%A7%A3%E6%9E%90%EF%BC%8C%E9%80%86%E5%9C%B0%E5%9D%80%E8%A7%A3%E6%9E%90%EF%BC%8COpenStreetMap%E5%BC%80%E6%BA%90%E5%9C%B0%E5%9B%BE%E6%95%B0%E6%8D%AE%E3%80%90%E5%85%A8%E7%BD%91%E6%9C%80%E5%85%A8%E3%80%91.html","title":"【中】Nominatim免费的地址解析，逆地址解析，OpenStreetMap开源地图数据【全网最全】","lang":"zh-CN","frontmatter":{"title":"【中】Nominatim免费的地址解析，逆地址解析，OpenStreetMap开源地图数据【全网最全】","shortTitle":"【中】Nominatim免费的地址解析","date":"2024-06-22T14:45:55.000Z","category":["中级","视频讲解"],"tag":["地图"],"description":"视频学习地址 国内的一些地址解析供应商的API都开始付费了，就想找个免费的地址解析和逆地址解析的应用，最终选择了Nominatim + OpenStreetMap 这篇文章将会从调研、选型、测试、应用全方面的解析，如果你也在找地址解析和逆地址解析的开源方案它一定会给你带来帮助 地址解析：通过一个地名（深圳），获取当前地方的经纬度、省市区级别 逆地址解析...","head":[["meta",{"property":"og:url","content":"https://vuepress-theme-hope-docs-demo.netlify.app/30%E6%89%A9%E5%B1%95%E5%AD%A6%E4%B9%A0/Nominatim%E5%85%8D%E8%B4%B9%E7%9A%84%E5%9C%B0%E5%9D%80%E8%A7%A3%E6%9E%90%EF%BC%8C%E9%80%86%E5%9C%B0%E5%9D%80%E8%A7%A3%E6%9E%90%EF%BC%8COpenStreetMap%E5%BC%80%E6%BA%90%E5%9C%B0%E5%9B%BE%E6%95%B0%E6%8D%AE%E3%80%90%E5%85%A8%E7%BD%91%E6%9C%80%E5%85%A8%E3%80%91.html"}],["meta",{"property":"og:site_name","content":"小道仙Java笔记"}],["meta",{"property":"og:title","content":"【中】Nominatim免费的地址解析，逆地址解析，OpenStreetMap开源地图数据【全网最全】"}],["meta",{"property":"og:description","content":"视频学习地址 国内的一些地址解析供应商的API都开始付费了，就想找个免费的地址解析和逆地址解析的应用，最终选择了Nominatim + OpenStreetMap 这篇文章将会从调研、选型、测试、应用全方面的解析，如果你也在找地址解析和逆地址解析的开源方案它一定会给你带来帮助 地址解析：通过一个地名（深圳），获取当前地方的经纬度、省市区级别 逆地址解析..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-07-23T14:12:53.000Z"}],["meta",{"property":"article:author","content":"小道仙97"}],["meta",{"property":"article:tag","content":"地图"}],["meta",{"property":"article:published_time","content":"2024-06-22T14:45:55.000Z"}],["meta",{"property":"article:modified_time","content":"2024-07-23T14:12:53.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"【中】Nominatim免费的地址解析，逆地址解析，OpenStreetMap开源地图数据【全网最全】\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2024-06-22T14:45:55.000Z\\",\\"dateModified\\":\\"2024-07-23T14:12:53.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"小道仙97\\",\\"url\\":\\"https://java.xdx97.com\\"}]}"]]},"headers":[{"level":2,"title":"一、选型","slug":"一、选型","link":"#一、选型","children":[{"level":3,"title":"1-1、数据源","slug":"_1-1、数据源","link":"#_1-1、数据源","children":[]},{"level":3,"title":"1-2、地理编码引擎","slug":"_1-2、地理编码引擎","link":"#_1-2、地理编码引擎","children":[]},{"level":3,"title":"2-1、初尝Nominatim","slug":"_2-1、初尝nominatim","link":"#_2-1、初尝nominatim","children":[]},{"level":3,"title":"2-2、OSM数据解析","slug":"_2-2、osm数据解析","link":"#_2-2、osm数据解析","children":[]},{"level":3,"title":"2-3、Nominatim和OSM数据关系映射","slug":"_2-3、nominatim和osm数据关系映射","link":"#_2-3、nominatim和osm数据关系映射","children":[]},{"level":3,"title":"2-4、举一反三","slug":"_2-4、举一反三","link":"#_2-4、举一反三","children":[]},{"level":3,"title":"2-5、Nominatim API解析","slug":"_2-5、nominatim-api解析","link":"#_2-5、nominatim-api解析","children":[]}]},{"level":2,"title":"三、安装","slug":"三、安装","link":"#三、安装","children":[]},{"level":2,"title":"四、关于数据源 （重要）","slug":"四、关于数据源-重要","link":"#四、关于数据源-重要","children":[]},{"level":2,"title":"五、替代方案","slug":"五、替代方案","link":"#五、替代方案","children":[]},{"level":2,"title":"N、其它","slug":"n、其它","link":"#n、其它","children":[{"level":3,"title":"N-1、place和placex","slug":"n-1、place和placex","link":"#n-1、place和placex","children":[]},{"level":3,"title":"N-2、相关资料","slug":"n-2、相关资料","link":"#n-2、相关资料","children":[]},{"level":3,"title":"N-3、测试覆盖","slug":"n-3、测试覆盖","link":"#n-3、测试覆盖","children":[]},{"level":3,"title":"逆地址解析","slug":"逆地址解析","link":"#逆地址解析","children":[]}]}],"git":{"createdTime":1721743973000,"updatedTime":1721743973000,"contributors":[{"name":"ziyangtao","email":"ziyangtao@distinctclinic.com","commits":1}]},"readingTime":{"minutes":12.86,"words":3857},"filePathRelative":"30扩展学习/Nominatim免费的地址解析，逆地址解析，OpenStreetMap开源地图数据【全网最全】.md","localizedDate":"2024年6月22日","excerpt":"<br>\\n<p><a href=\\"https://www.bilibili.com/video/BV1sf421B71M\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">视频学习地址</a></p>\\n<br>\\n<blockquote>\\n<p>国内的一些地址解析供应商的API都开始付费了，就想找个免费的地址解析和逆地址解析的应用，最终选择了Nominatim + OpenStreetMap</p>\\n</blockquote>\\n<br>\\n<p>这篇文章将会从调研、选型、测试、应用全方面的解析，如果你也在找地址解析和逆地址解析的开源方案它一定会给你带来帮助</p>","autoDesc":true}');export{w as comp,M as data};
